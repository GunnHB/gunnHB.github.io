---
title:  "[네트워크] 001. 서버의 기본"
excerpt: "언리얼에서의 서버를 위한 기본적인 내용을 알아봅시다!"

author: gunnHB
categories: 
 - Network
tags: 
 - [Github, Git, Unreal, Programming, Network, C++]

toc: true
toc_sticky: true
 
date: 2024-09-08
last_modified_at: 2024-09-08
---

## Socket
`소켓Socket`이란 <u>운영체제가 제공하는 통신 객체</u>입니다. 소켓을 통해 데이터르 주고 받을 때 두 가지의 방식이 존재하는데,

- 동기 소켓
    - 상대 소켓에 데이터 전달이 완료될 때까지 다른 작업이 불가능
    - 일반적인 함수의 호출과 같은 방식 (함수가 종료될 때까지 다른 작업을 하지 않는 것처럼)

- 비동기 소켓
    - 운영체제에 데이터 전송 요청 후 다음 작업을 진행
    - 데이터 전송이 끝나면 지정된 함수를 통해 완료 처리
    - 많은 양의 데이터를 전송할 때 유용하다. (동기 방식으로 사용하면 프로그램이 멈춘 것처럼 느꺼진다.)

물론 네트워크에서만 동기/비동기 방식을 사용하는 것이 아닌 일반적인 프로그래밍에서도 사용 가능합니다. 예를 들어
게임에서의 맵을 로딩할 때 한번에 모든 에셋을 로딩하게 되면 시간이 오래 걸릴 것입니다. 그렇기 때문에 유저에게 보이는
부분만 불러오고 상황에 따라 에셋을 생성 또는 제거하게 되는 것입니다.

## WinSock2
C++에서의 통신을 위해서는 우선 `WinSock2.h`를 추가해줘야 합니다. 이는 <u>윈도우에서 제공해주는 소켓을 사용한다</u>는 의미입니다.

```c++
#include <WinSock2.h>
```

추가적으로 WinSock2.h는 라이브러리 링크를 걸어줘야 하는데 우선 `라이브러리`란 <u>여러 특정 기능을 수행할 수 있는 변수와 함수들의 집합</u>이라고 생각하면 됩니다. 이를 이용해
필요한 기능이 있다면 가져다 사용하면 됩니다. 라이브러리는 크게 두 가지로 나뉘는데,

- 정적 링크 라이브러리 (lib)
    - 링크를 걸면 라이브러리의 코드가 실행파일에 합쳐진다.
    - 전처리기를 이용해 링크를 걸기 때문에 컴파일 전에 처리되어 실행파일에 묶이게 된다.
    - 실행파일의 크기가 라이브러리만큼 커지게 된다. 단, 라이브러리 없이 실행파일만으로 동작 가능하다.

- 동적 링크 라이브러리 (dll)
    - 실행 후에 참조된다. 그렇기 때문에 실행파일에 포함되지 않는다.
    - 별도의 dll 파일이 있어야 동작이 가능하다.
    - 메모리에 올라간 dll 코드는 둘 이상의 프로세스가 공유하는 구조를 가지게 된다. 
    - 메모리의 효율성이 좋다.

링크를 걸 때는 코드 상단에 `#pragma comment`를 추가하거나 `프로젝트 - 속성 - 링커`에 원하는 라이브러리를 걸 수 있습니다.


## WORD
CPU는 연산을 진행하기 위해 `레지스터`라는 공간에 데이터를 가져와 연산을 진행하게 되는데, 한번에 처리할 수 있는 크기는 CPU마다 다릅니다.
CPU는 32비트와 64비트로 나뉘는데 이것이 <u>레지스터의 크기를 나타내는 것</u>입니다. `WORD`는 <u>CPU가 한번에 처리할 수 있는 데이터의 크기 단위</u>를 나타냅니다.

WORD의 크기는 unsigned short 즉, 2바이트입니다.
{: .notice--info}

이러한 WORD는 `MAKEWORD`를 통해 간단하게 만들 수 있습니다. MAKEWORD는 WORD를 만들어주는 매크로이며, 인자로 bLow와 bHigh를 받습니다. 이는 각각
하위와 상위 8비트에 채워질 데이터를 의미합니다.

일반적으로 MAKEWORD(2, 2)를 이용해 생성하는데, 16진수 정수인 0x0202를 반환하게 되고 이는 winsock의 2.2 버전을 사용하겠다는 것을 의미합니다.

## 연결지향형과 비연결지향형
소켓은 `연결지향형 소켓`과 `비연결지향형 소켓`으로 나뉩니다.

- 연결 지향형 소켓 (TCP)
    - 소켓이 서로 연결된 상태에서 통신하는 것
    - 전화와 같은 방식
    - 통신을 진행할 때 클라이언트가 서버에게 연결 요청을 보내야 한다. 이를 받아주는 것이 `리슨 소켓`
    - 연결을 받아주면 요청한 클라이언트와 서버 간에 연결된 하나의 소켓이 만들어진다.
    - 데이터가 잘 전달되었는지 `4-Way Handshake`를 통해 확인한다. 상대방에게 모든 데이터가 전달되는 것을 보장한다.
    - 전송되는 중에 잘 넘어가고 있는지 확인하는 과정이 존재한다. 이로 인해 상대적으로 느려진다.

- 비연결 지향형 소켓 (UDP)
    - 통신할 소켓이 서로 연결되지 않아도 통신이 가능하다.
    - 우편과 같은 방식
    - 통신 과정에서 유실의 위험이 있다. 다시 말해 온전한 데이터의 전달을 보장할 수 없다. 하지만 속도는 빠르다.

`리슨 소켓Listen Socket`이란 클라이언트로부터 들어오는 접속 요청을 수락해주고 연결될 소켓을 생성해주는 역할을 합니다.